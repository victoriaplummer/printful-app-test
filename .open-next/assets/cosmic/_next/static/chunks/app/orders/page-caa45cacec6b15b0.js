(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[778],{1109:(e,s,t)=>{"use strict";t.d(s,{A:()=>u});var l=t(5155),r=t(2108),i=t(6715),n=t(9373),a=t(2115),o=t(5111),c=t.n(o);let d=c().basePath;function m(e){let{selectedSiteId:s,onSiteSelect:t}=e,[r,i]=(0,a.useState)([]),[n,o]=(0,a.useState)(!0),[c,m]=(0,a.useState)(null);return((0,a.useEffect)(()=>{(async function(){try{var e;o(!0),m(null);let l=await fetch("".concat(d,"/api/webflow/sites"));if(!l.ok)throw Error("Failed to fetch sites: ".concat(l.status," ").concat(l.statusText));let r=await l.json();i(r.sites||[]),(null===(e=r.sites)||void 0===e?void 0:e.length)!==1||s||t(r.sites[0].id)}catch(e){console.error("Error fetching Webflow sites:",e),m(e instanceof Error?e.message:String(e))}finally{o(!1)}})()},[t,s]),n)?(0,l.jsxs)("div",{className:"alert alert-info",children:[(0,l.jsx)("span",{className:"loading loading-spinner loading-sm"}),(0,l.jsx)("span",{children:"Loading Webflow sites..."})]}):c?(0,l.jsxs)("div",{className:"alert alert-error",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,l.jsxs)("span",{children:["Error: ",c]})]}):0===r.length?(0,l.jsxs)("div",{className:"alert alert-warning",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,l.jsx)("span",{children:"No Webflow sites found. Please create a site in Webflow first."})]}):(0,l.jsxs)("div",{className:"form-control mb-4",children:[(0,l.jsx)("label",{className:"label",htmlFor:"webflow-site-selector",children:(0,l.jsx)("span",{className:"label-text",children:"Select Webflow Site"})}),(0,l.jsxs)("select",{id:"webflow-site-selector",className:"select select-bordered bg-base-300 w-full focus:outline-primary text-base-content",value:s||"",onChange:e=>{let s=e.target.value;s&&t(s)},children:[(0,l.jsx)("option",{value:"",disabled:!0,children:r.length>1?"Select a Webflow site":"Select site"}),r.map(e=>(0,l.jsx)("option",{value:e.id,className:"text-base-content",children:e.displayName||e.shortName},e.id))]})]})}var h=t(2118);let x=c().basePath;function u(e){let{onSettingsChange:s}=e,{data:t}=(0,r.useSession)(),{settings:a,updateSettings:o}=(0,h.z)(),c=(0,i.jE)(),{data:d,isLoading:u}=(0,n.I)({queryKey:["webflow-sites"],queryFn:async()=>{let e=await fetch("".concat(x,"/api/webflow/sites"));if(!e.ok)throw Error("Failed to fetch sites");return e.json()},enabled:!!(null==t?void 0:t.webflowAccessToken)}),f=e=>{let t={...a,syncOptions:{...a.syncOptions,[e]:!a.syncOptions[e]}};o(t),null==s||s(t)};return(null==t?void 0:t.webflowAccessToken)?u?(0,l.jsx)("div",{children:"Loading sites..."}):(0,l.jsx)("div",{className:"card bg-base-100 shadow-xl",children:(0,l.jsxs)("div",{className:"card-body",children:[(0,l.jsx)("h2",{className:"card-title",children:"Webflow Settings"}),(0,l.jsx)("p",{className:"text-sm opacity-70 mb-3",children:"Select the Webflow site where you want to sync your Printful products."}),(0,l.jsx)(m,{sites:(null==d?void 0:d.result)||[],selectedSiteId:a.siteId,onSiteSelect:e=>{let t={...a,siteId:e};o(t),null==s||s(t),c.invalidateQueries({queryKey:["orders"]}),c.invalidateQueries({queryKey:["order-details"]})}}),a.siteId&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"divider",children:"Sync Options"}),(0,l.jsx)("div",{className:"form-control",children:(0,l.jsxs)("label",{className:"label cursor-pointer justify-start gap-4",children:[(0,l.jsx)("input",{type:"checkbox",className:"checkbox checkbox-primary",checked:a.syncOptions.autoDraft,onChange:()=>f("autoDraft")}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"label-text font-medium",children:"Auto Draft"}),(0,l.jsx)("p",{className:"text-xs opacity-70",children:"Create products as drafts instead of publishing immediately"})]})]})}),(0,l.jsx)("div",{className:"form-control",children:(0,l.jsxs)("label",{className:"label cursor-pointer justify-start gap-4",children:[(0,l.jsx)("input",{type:"checkbox",className:"checkbox checkbox-primary",checked:a.syncOptions.includeImages,onChange:()=>f("includeImages")}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"label-text font-medium",children:"Include Images"}),(0,l.jsx)("p",{className:"text-xs opacity-70",children:"Sync product images from Printful"})]})]})}),(0,l.jsx)("div",{className:"form-control",children:(0,l.jsxs)("label",{className:"label cursor-pointer justify-start gap-4",children:[(0,l.jsx)("input",{type:"checkbox",className:"checkbox checkbox-primary",checked:a.syncOptions.skipExisting,onChange:()=>f("skipExisting")}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"label-text font-medium",children:"Skip Existing"}),(0,l.jsx)("p",{className:"text-xs opacity-70",children:"Skip products that already exist in Webflow"})]})]})})]})]})}):(0,l.jsxs)("div",{className:"alert alert-warning",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,l.jsx)("span",{children:"Please connect your Webflow account first"})]})}},2118:(e,s,t)=>{"use strict";t.d(s,{z:()=>n});var l=t(2115);let r="webflowSettings",i={siteId:"",syncOptions:{autoDraft:!0,includeImages:!0,skipExisting:!1}};function n(){let[e,s]=(0,l.useState)(i);return(0,l.useEffect)(()=>{let e=localStorage.getItem(r);if(e)try{let t=JSON.parse(e);s(t)}catch(e){console.error("Failed to parse saved WebflowSettings:",e)}},[]),{settings:e,updateSettings:e=>{s(e),localStorage.setItem(r,JSON.stringify(e))}}}},4325:(e,s,t)=>{"use strict";t.d(s,{default:()=>v});var l=t(5155),r=t(2115),i=t(2108),n=t(5695),a=t(1109),o=t(6715),c=t(9373),d=t(5041);function m(e){let{orders:s,selectedOrderId:t,onSelectOrder:r}=e;if(!s.length)return(0,l.jsx)("p",{className:"text-gray-500",children:"No orders found"});let i=e=>{let s=new Date(e);return s.toLocaleDateString()+" "+s.toLocaleTimeString()};return(0,l.jsx)("div",{className:"overflow-y-auto max-h-[70vh]",children:(0,l.jsx)("ul",{className:"divide-y divide-gray-200",children:s.map(e=>(0,l.jsx)("li",{className:"py-3 cursor-pointer hover:bg-base-200 transition-colors ".concat(t===e.id?"bg-base-200":""),onClick:()=>r(e.id),children:(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"font-medium",children:e.orderNumber}),(0,l.jsx)(h,{status:e.fulfillmentStatus})]}),(0,l.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:e.customerName}),(0,l.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,l.jsxs)("span",{className:"text-sm font-medium",children:["$",e.total.toFixed(2)]}),(0,l.jsx)("span",{className:"text-xs text-gray-500",children:i(e.createdOn)})]})]})},e.id))})})}function h(e){let{status:s}=e,t="px-2 py-1 text-xs rounded-full";switch(s){case"fulfilled":t+=" bg-green-100 text-green-800";break;case"partially_fulfilled":t+=" bg-yellow-100 text-yellow-800";break;default:t+=" bg-gray-100 text-gray-800"}return(0,l.jsx)("span",{className:t,children:"unfulfilled"===s?"Unfulfilled":"partially_fulfilled"===s?"Partial":"Fulfilled"})}var x=t(6766);function u(){return(0,l.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,l.jsx)("div",{className:"loading loading-spinner loading-lg"})})}function f(e){let{message:s}=e;return(0,l.jsxs)("div",{className:"alert alert-error",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,l.jsx)("span",{children:s})]})}function j(e){var s;let{orderId:t,siteId:i,onOrderFulfilled:n}=e,[a,o]=(0,r.useState)(null),{data:m,isLoading:h,isError:j,error:p}=(0,c.I)({queryKey:["order-details",i,t],queryFn:async()=>{let e=await fetch("/api/webflow/orders/".concat(t,"?siteId=").concat(i));if(!e.ok)throw Error("Failed to fetch order details");return e.json()}}),{mutate:g,isPending:v}=(0,d.n)({mutationFn:async()=>{let e=await fetch("/api/webflow/orders/fulfill",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:t,siteId:i})});if(!e.ok)throw Error((await e.json()).error||"Failed to send order to Printful");return e.json()},onSuccess:()=>{o(null),n()},onError:e=>{o(e.message||"Failed to send order to Printful")}});if(h)return(0,l.jsx)(u,{});if(j)return(0,l.jsx)(f,{message:"Error loading order details: ".concat(null==p?void 0:p.toString())});if(!(null==m?void 0:m.result))return(0,l.jsx)("div",{children:"No order details found"});let{result:b}=m;return(0,l.jsxs)("div",{className:"bg-base-100 shadow rounded-lg p-6",children:[(0,l.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("h2",{className:"text-xl font-semibold",children:["Order #",b.orderNumber]}),(0,l.jsxs)("p",{className:"text-sm text-gray-500",children:["Created on ",new Date(b.createdOn).toLocaleString()]})]}),"unfulfilled"===b.fulfillmentStatus&&(0,l.jsx)("button",{className:"btn btn-primary",onClick:()=>g(),disabled:v,children:v?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"loading loading-spinner loading-xs"}),"Sending to Printful..."]}):"Send to Printful"})]}),a&&(0,l.jsxs)("div",{className:"alert alert-error mb-4",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,l.jsx)("span",{children:a})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-semibold mb-2",children:"Customer Information"}),(0,l.jsxs)("div",{className:"text-sm",children:[(0,l.jsx)("p",{className:"font-medium",children:b.customerInfo.name}),(0,l.jsx)("p",{children:b.customerInfo.email}),b.customerInfo.phone&&(0,l.jsx)("p",{children:b.customerInfo.phone})]}),(0,l.jsx)("h3",{className:"font-semibold mt-4 mb-2",children:"Shipping Address"}),(0,l.jsxs)("div",{className:"text-sm",children:[(0,l.jsx)("p",{children:b.customerInfo.address.line1}),b.customerInfo.address.line2&&(0,l.jsx)("p",{children:b.customerInfo.address.line2}),(0,l.jsxs)("p",{children:[b.customerInfo.address.city,","," ",b.customerInfo.address.state," ",b.customerInfo.address.postalCode]}),(0,l.jsx)("p",{children:b.customerInfo.address.country})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-semibold mb-2",children:"Order Items"}),(0,l.jsx)("div",{className:"space-y-4",children:null===(s=b.purchasedItems)||void 0===s?void 0:s.map(e=>(0,l.jsxs)("div",{className:"flex items-start gap-4",children:[e.thumbnailUrl&&(0,l.jsx)("div",{className:"w-16 h-16 relative",children:(0,l.jsx)(x.default,{src:e.thumbnailUrl,alt:e.name,fill:!0,className:"object-cover rounded"})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("p",{className:"font-medium",children:e.name}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:e.variantName}),(0,l.jsxs)("div",{className:"flex justify-between mt-1",children:[(0,l.jsxs)("p",{className:"text-sm",children:["$",e.price," \xd7 ",e.quantity]}),(0,l.jsxs)("p",{className:"font-medium",children:["$",(e.price*e.quantity).toFixed(2)]})]})]})]},e.id))}),(0,l.jsx)("div",{className:"border-t mt-4 pt-4",children:(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("p",{className:"font-semibold",children:"Total"}),(0,l.jsxs)("p",{className:"font-semibold",children:["$",b.total.toFixed(2)]})]})}),b.notes&&(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)("h3",{className:"font-semibold mb-2",children:"Order Notes"}),(0,l.jsx)("p",{className:"text-sm",children:b.notes})]}),b.shippingInfo.tracking&&(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)("h3",{className:"font-semibold mb-2",children:"Shipping Information"}),(0,l.jsxs)("div",{className:"text-sm",children:[(0,l.jsxs)("p",{children:["Provider: ",b.shippingInfo.provider]}),(0,l.jsxs)("p",{children:["Tracking:"," ",b.shippingInfo.trackingUrl?(0,l.jsx)("a",{href:b.shippingInfo.trackingUrl,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:b.shippingInfo.tracking}):b.shippingInfo.tracking]})]})]})]})]})]})}var p=t(2118);function g(){var e,s;let[t,i]=(0,r.useState)(null),[n,a]=(0,r.useState)(null),{settings:h}=(0,p.z)(),x=(0,o.jE)(),{data:g,isLoading:v,error:b}=(0,c.I)({queryKey:["orders",h.siteId],queryFn:async()=>{if(!h.siteId)return{result:[]};let e=await fetch("/api/webflow/orders?siteId=".concat(h.siteId));if(!e.ok)throw Error("Failed to fetch orders");return e.json()},enabled:!!h.siteId,staleTime:3e4,gcTime:3e5,refetchOnWindowFocus:!1}),{mutate:N,isPending:w}=(0,d.n)({mutationFn:async()=>{let e=await fetch("/api/webflow/orders/fulfill-bulk",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:h.siteId})});if(!e.ok)throw Error((await e.json()).error||"Failed to send orders to Printful");return e.json()},onSuccess:()=>{a(null),x.invalidateQueries({queryKey:["orders",h.siteId]})},onError:e=>{a(e.message||"Failed to send orders to Printful")}}),y=(null==g?void 0:null===(e=g.result)||void 0===e?void 0:e.filter(e=>"unfulfilled"===e.fulfillmentStatus).length)||0;return v?(0,l.jsx)(u,{}):b?(0,l.jsx)(f,{message:b.toString()}):(0,l.jsxs)(l.Fragment,{children:[n&&(0,l.jsxs)("div",{className:"alert alert-error mb-4",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,l.jsx)("span",{children:n})]}),(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsxs)("h2",{className:"text-xl font-semibold",children:["Orders (",(null==g?void 0:null===(s=g.result)||void 0===s?void 0:s.length)||0,")"]}),y>0&&(0,l.jsx)("button",{className:"btn btn-primary",onClick:()=>N(),disabled:w,children:w?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"loading loading-spinner loading-xs"}),"Sending ",y," orders..."]}):"Send All to Printful (".concat(y,")")})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsx)(m,{orders:(null==g?void 0:g.result)||[],selectedOrderId:t,onSelectOrder:i}),t&&(0,l.jsx)(j,{orderId:t,siteId:h.siteId,onOrderFulfilled:()=>{x.invalidateQueries({queryKey:["orders",h.siteId]})}})]})]})}function v(){let{data:e}=(0,i.useSession)(),s=(0,n.useRouter)(),{settings:t,updateSettings:o}=(0,p.z)();return((0,r.useEffect)(()=>{if(!e||e&&!e.isMultiConnected){s.push("/");return}},[e,s]),e)?(0,l.jsx)("div",{className:"flex min-h-screen flex-col",children:(0,l.jsx)("main",{className:"flex-1 p-8",children:(0,l.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Orders"}),(0,l.jsx)("div",{className:"mb-6",children:(0,l.jsx)(a.A,{onSettingsChange:o,initialSettings:t})}),t.siteId?(0,l.jsx)(g,{}):(0,l.jsxs)("div",{className:"alert alert-info",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"stroke-current shrink-0 w-6 h-6",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,l.jsx)("span",{children:"Please select a Webflow site to view orders."})]})]})})}):(0,l.jsx)("div",{className:"flex min-h-screen flex-col",children:(0,l.jsx)("main",{className:"flex-1 p-8",children:(0,l.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,l.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Loading..."})})})})}},5111:e=>{"use strict";e.exports={reactStrictMode:!0,basePath:"/cosmic",images:{remotePatterns:[{protocol:"https",hostname:"files.cdn.printful.com"}]}}},6834:(e,s,t)=>{Promise.resolve().then(t.bind(t,4325))}},e=>{var s=s=>e(e.s=s);e.O(0,[108,25,260,441,684,358],()=>s(6834)),_N_E=e.O()}]);