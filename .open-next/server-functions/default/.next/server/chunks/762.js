exports.id=762,exports.ids=[762],exports.modules={12095:e=>{"use strict";e.exports={reactStrictMode:!0,basePath:"/cosmic",images:{remotePatterns:[{protocol:"https",hostname:"files.cdn.printful.com"}]}}},16886:(e,t,r)=>{"use strict";r.d(t,{X:()=>a,R:()=>i});let o={PRINTFUL:"printful_auth"},s={},n={getPrintfulAuth:()=>{let e=s[o.PRINTFUL];return!e||e.expiresAt&&Date.now()>e.expiresAt?(delete s[o.PRINTFUL],null):e.token}};if(!process.env.PRINTFUL_CLIENT_ID||!process.env.PRINTFUL_CLIENT_SECRET)throw Error("Missing Printful OAuth credentials");let i={id:"printful",name:"Printful",type:"oauth",authorization:{url:"https://www.printful.com/oauth/authorize",params:{client_id:process.env.PRINTFUL_CLIENT_ID,redirect_url:"https://webflow-printful-sync-utility.vercel.app/api/auth/callback/printful",response_type:"code"}},token:{url:"https://www.printful.com/oauth/token",async request(e){let{provider:t,params:r}=e,o=await fetch("https://www.printful.com/oauth/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",client_id:t.clientId,client_secret:t.clientSecret,code:r.code,redirect_url:"https://webflow-printful-sync-utility.vercel.app/api/auth/callback/printful"})}),s=await o.json(),n=s.access_token||s.result?.access_token,i=s.refresh_token||s.result?.refresh_token;if(!n)throw Error("Failed to get access token from Printful");return{tokens:{access_token:n,refresh_token:i,expires_at:s.expires_in?Math.floor(Date.now()/1e3)+s.expires_in:void 0,token_type:s.token_type||"Bearer"}}}},userinfo:{url:"https://api.printful.com/store/products",async request(e){let{tokens:t}=e;if(!(await fetch("https://api.printful.com/store/products",{headers:{Authorization:`Bearer ${t.access_token}`}})).ok)throw Error("Failed to validate Printful token");return{sub:"printful-user",name:"Printful Store"}}},clientId:process.env.PRINTFUL_CLIENT_ID,clientSecret:process.env.PRINTFUL_CLIENT_SECRET,profile:e=>({id:"printful-"+Date.now(),name:e.name||"Printful Store",email:void 0,image:void 0})};async function a(e){return"printful"===e?n.getPrintfulAuth():null}},44678:(e,t,r)=>{"use strict";r.d(t,{N:()=>R});var o=r(16886),s=r(12095),n=r.n(s);let i=n().basePath||"";if(!process.env.WEBFLOW_CLIENT_ID||!process.env.WEBFLOW_CLIENT_SECRET)throw Error("Missing Webflow OAuth credentials");let a=()=>{if(process.env.WEBFLOW_REDIRECT_URI)return process.env.WEBFLOW_REDIRECT_URI.startsWith("http")?process.env.WEBFLOW_REDIRECT_URI:`https://${process.env.WEBFLOW_REDIRECT_URI}`;let e=process.env.NEXTAUTH_URL||`http://localhost:3000${i}`;return console.log("baseUrl",e),`${e}/api/auth/callback/webflow`},c={id:"webflow",name:"Webflow",type:"oauth",authorization:{url:"https://webflow.com/oauth/authorize",params:{scope:"sites:read ecommerce:read ecommerce:write authorized_user:read cms:read cms:write",client_id:process.env.WEBFLOW_CLIENT_ID,redirect_uri:a(),response_type:"code"}},token:{url:"https://api.webflow.com/oauth/access_token",async request({provider:e,params:t}){console.log("Starting token exchange with params:",{hasClientId:!!e.clientId,hasClientSecret:!!e.clientSecret,hasCode:!!t.code,redirectUri:a()});let r=await fetch("https://api.webflow.com/oauth/access_token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:new URLSearchParams({client_id:e.clientId||"",client_secret:e.clientSecret||"",code:t.code||"",grant_type:"authorization_code",redirect_uri:a()}).toString(),signal:AbortSignal.timeout(1e4)}),o=await r.text();if(console.log("Token exchange response status:",r.status),console.log("Token exchange response received (sensitive data not logged)"),!r.ok)throw Error(`Token exchange failed: ${r.status} ${r.statusText}`);try{let e=JSON.parse(o);if(!e.access_token)throw Error("Access token missing from response");return{tokens:{access_token:e.access_token,token_type:e.token_type,expires_in:e.expires_in,refresh_token:e.refresh_token}}}catch(e){throw console.error("Failed to parse token response:",e),Error(`Invalid token response: ${e instanceof Error?e.message:String(e)}`)}}},userinfo:{url:"https://api.webflow.com/v2/token/authorized_by",async request(e){let t=e.tokens?.access_token;if(!t)throw console.error("No access token found in context"),Error("No access token available for Webflow API request");let r=await fetch("https://api.webflow.com/v2/token/authorized_by",{headers:{Authorization:`Bearer ${t}`,accept:"application/json","accept-version":"2.0.0"},signal:AbortSignal.timeout(1e4)});if(!r.ok){let e=await r.text();throw console.error(`Webflow user info error (${r.status}):`,e),Error(`Failed to fetch Webflow user info: ${r.status} ${r.statusText}. Details: ${e}`)}try{let e=await r.json();if(console.log("User profile data received"),!e.id||!e.email)throw console.error("Invalid profile data structure:",JSON.stringify(e)),Error("Invalid profile data structure from Webflow API");return e}catch(e){throw console.error("Failed to parse user profile:",e),Error(`Invalid user profile response: ${e instanceof Error?e.message:String(e)}`)}}},clientId:process.env.WEBFLOW_CLIENT_ID,clientSecret:process.env.WEBFLOW_CLIENT_SECRET,profile:e=>({id:e.id,name:`${e.firstName} ${e.lastName}`,email:e.email,image:null})};var l=r(70300),u=r.n(l);let p={},f="auth:printful:token",d="auth:webflow:token",h=!1,w=null,_=!1,T={},k=()=>process.env.PATH_INFO?.includes("/api/auth")||process.env.NEXT_URL?.includes("/api/auth"),E=()=>{if(k())return console.log("Auth path detected, using memory storage only"),null;if(null!==w||_)return w;try{_=!0;let e=process.env.REDIS_URL;if(!e)return console.log("No Redis URL provided. Using in-memory storage only."),null;return h=!0,(w=new(u())(e,{maxRetriesPerRequest:3,connectTimeout:1e4,enableReadyCheck:!0,tls:{rejectUnauthorized:!1},retryStrategy:e=>e>3?(console.log("Redis connection failed, using memory storage instead"),h=!1,_=!1,null):Math.min(200*e,1e3)})).on("error",e=>{console.error("Redis connection error:",e),h=!1}),w.on("connect",()=>{console.log("Redis connected successfully"),h=!0,_=!1}),w}catch(e){return console.error("Error initializing Redis:",e),h=!1,_=!1,null}};async function m(e,t,r=604800){let o="printful"===e?f:d;p[o]=t;let s=E();if(h&&s)try{await s.set(o,t,"EX",r)}catch(e){console.error(`Redis error (fallback to memory): ${e}`)}}async function g(e){let t="printful"===e?f:d,r=T[t];if(r&&r.expires>Date.now())return r.value;let o=E();if(h&&o)try{let e=await o.get(t);if(e)return T[t]={value:e,expires:Date.now()+6e4},e}catch(e){console.error(`Redis error (fallback to memory): ${e}`)}return p[t]||null}let v={storeProviderToken:m,getProviderToken:g},I=n().basePath||"";if(!process.env.PRINTFUL_CLIENT_ID||!process.env.PRINTFUL_CLIENT_SECRET)throw Error("Missing Printful OAuth credentials");if(!process.env.WEBFLOW_CLIENT_ID||!process.env.WEBFLOW_CLIENT_SECRET)throw Error("Missing Webflow OAuth credentials");if(!process.env.NEXTAUTH_URL)throw Error("Missing NEXTAUTH_URL environment variable");console.log(`Auth config initialized with basePath: ${I}`),console.log(`NEXTAUTH_URL is set to: ${process.env.NEXTAUTH_URL}`);let R={providers:[c,o.R],session:{strategy:"jwt",maxAge:2592e3},callbacks:{signIn:async()=>!0,jwt:async({token:e,account:t})=>(t&&("printful"===t.provider&&t.access_token?(await v.storeProviderToken("printful",t.access_token),e.printfulAccessToken=t.access_token,e.webflowAccessToken||(e.webflowAccessToken=await v.getProviderToken("webflow")||void 0)):"webflow"===t.provider&&t.access_token&&(await v.storeProviderToken("webflow",t.access_token),e.webflowAccessToken=t.access_token,e.printfulAccessToken||(e.printfulAccessToken=await v.getProviderToken("printful")||void 0))),e),session:async({session:e,token:t})=>(e.printfulAccessToken=t.printfulAccessToken||await v.getProviderToken("printful")||void 0,e.webflowAccessToken=t.webflowAccessToken||await v.getProviderToken("webflow")||void 0,e.isMultiConnected=!!(e.printfulAccessToken&&e.webflowAccessToken),e)},pages:{signIn:"/"},secret:process.env.NEXTAUTH_SECRET,debug:!0}},78335:()=>{},96487:()=>{}};