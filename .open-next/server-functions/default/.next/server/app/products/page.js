(()=>{var e={};e.id=571,e.ids=[571],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5781:(e,s,t)=>{Promise.resolve().then(t.bind(t,8547))},8547:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/vicplummer/printful-app-test/src/app/products/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/vicplummer/printful-app-test/src/app/products/page.tsx","default")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19489:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>b});var r=t(60687),a=t(43210),n=t.n(a),i=t(82136),l=t(16189),o=t(26785),c=t(8693),d=t(54050);function u({status:e,showText:s=!0}){let{badgeClass:t,text:a,icon:n}=(()=>{switch(e){case"synced":return{badgeClass:"badge-success",text:"Synced",icon:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"inline-block w-4 h-4 stroke-current",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})};case"error":return{badgeClass:"badge-error",text:"Error",icon:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"inline-block w-4 h-4 stroke-current",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})};case"syncing":return{badgeClass:"badge-warning",text:"Syncing",icon:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"inline-block w-4 h-4 stroke-current animate-spin",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})};default:return{badgeClass:"badge-outline",text:"Not Synced",icon:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"inline-block w-4 h-4 stroke-current",children:(0,r.jsx)("circle",{cx:"12",cy:"12",r:"10",strokeWidth:"2"})})}}})();return(0,r.jsxs)("div",{className:`badge ${t} gap-1`,children:[n,s&&(0,r.jsx)("span",{children:a})]})}var p=t(30474);let h=async({productId:e,settings:s})=>{if(!s.siteId)throw Error("No Webflow site selected");try{let t;console.log(`Syncing product ${e} to Webflow site ${s.siteId}...`,{settings:s});let r=await fetch("/api/auth/session"),a=await r.json();if(!a||!a.user)throw console.error("Not authenticated - session check failed",a),Error("You need to be logged in to sync products");console.log("Session check passed, proceeding with sync");let n=await fetch("/api/webflow/sync",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({productId:e,siteId:s.siteId,autoDraft:s.syncOptions.autoDraft,includeImages:s.syncOptions.includeImages,skipExisting:s.syncOptions.skipExisting})});console.log("Sync API response:",{status:n.status,statusText:n.statusText,headers:Object.fromEntries([...n.headers.entries()])});let i=await n.text();console.log("Raw response:",i);try{t=JSON.parse(i)}catch(e){throw console.error("Failed to parse response as JSON:",e),Error(i||"Unknown server error")}if(!n.ok)throw Error(t.error||`Server error: ${n.statusText}`);return t}catch(e){throw console.error("Error in sync process:",e),e}},m=({variant:e})=>(0,r.jsxs)("tr",{className:"hover",children:[(0,r.jsx)("td",{className:"px-6 py-3 whitespace-nowrap"}),(0,r.jsxs)("td",{className:"px-6 py-3 whitespace-nowrap flex items-center gap-2",children:[e.preview_url&&(0,r.jsx)("div",{className:"avatar",children:(0,r.jsx)("div",{className:"mask mask-squircle w-8 h-8 relative",children:(0,r.jsx)(p.default,{src:e.preview_url,alt:e.name,fill:!0,sizes:"32px",style:{objectFit:"cover"}})})}),(0,r.jsx)("div",{className:"text-sm",children:e.name})]}),(0,r.jsx)("td",{className:"px-6 py-3 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm opacity-70",children:e.variant_id})}),(0,r.jsx)("td",{className:"px-6 py-3 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"text-sm",children:["$",e.retail_price]})}),(0,r.jsx)("td",{className:"px-6 py-3 whitespace-nowrap",children:(0,r.jsx)(u,{status:e.sync_status||"not_synced"})}),(0,r.jsx)("td",{className:"px-6 py-3 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm",children:e.lastSynced?new Date(e.lastSynced).toLocaleString():"Never synced"})})]}),x=({product:e,onSyncAll:s,isSyncing:t,syncingProductId:a,selectedSiteId:n})=>(0,r.jsx)("tr",{className:"bg-base-200",children:(0,r.jsx)("td",{colSpan:6,className:"px-6 py-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[e.thumbnail_url?(0,r.jsx)("div",{className:"avatar",children:(0,r.jsx)("div",{className:"mask mask-squircle w-8 h-8 relative",children:(0,r.jsx)(p.default,{src:e.thumbnail_url,alt:e.name,fill:!0,sizes:"32px",style:{objectFit:"cover"}})})}):(0,r.jsx)("div",{className:"avatar placeholder",children:(0,r.jsx)("div",{className:"bg-neutral-focus text-neutral-content mask mask-squircle w-8 h-8",children:(0,r.jsx)("span",{children:"N/A"})})}),(0,r.jsx)("span",{className:"font-medium",children:e.name}),(0,r.jsxs)("span",{className:"text-xs opacity-70",children:["(",e.filteredVariants.length," variants)"]})]}),(0,r.jsx)("button",{onClick:()=>s(),className:"px-4 py-1.5 bg-primary text-primary-content rounded-md text-sm font-medium hover:bg-primary-dark hover:shadow-md hover:-translate-y-0.5 active:translate-y-0 active:shadow-none focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all duration-200 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:translate-y-0  disabled:hover:shadow-none disabled:hover:bg-primary flex items-center gap-2",disabled:t||!n,title:n?"Sync this product and all variants":"Select a Webflow site first",children:t&&e.id===a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"w-4 h-4 border-2 border-primary-content/30 border-t-primary-content rounded-full animate-spin"}),(0,r.jsx)("span",{children:"Syncing..."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),(0,r.jsx)("span",{children:"Sync All"})]})})]})})}),y=e=>{if(!e)return"not_synced";let s=new Date,t=new Date(e),r=Math.floor((s.getTime()-t.getTime())/864e5);return r<=10?"synced":r<=30?"warning":"stale"},v=({products:e,searchQuery:s,statusFilter:t,selectedSiteId:a,webflowSettings:i,isLoading:l})=>{let o=(0,c.jE)(),{mutate:u,isPending:p,variables:v}=(0,d.n)({mutationFn:h,onSuccess:(e,s)=>{o.setQueriesData({queryKey:["products"]},t=>Array.isArray(t)?t.map(t=>t.id===s.productId?{...t,variants:t.variants.map(s=>({...s,lastSynced:e.lastSynced||new Date().toISOString(),sync_status:"success"===e.status?"synced":"not_synced"}))}:t):t)},onError:e=>{console.error("Sync failed:",e.message)}}),f=async e=>{if(!a){alert("Please select a Webflow site first");return}try{await u({productId:e,settings:i})}catch(e){console.error("Error in handleSyncProduct:",e)}},g=n().useMemo(()=>(console.log("Products received:",e),Array.isArray(e))?e.filter(e=>{if(!e||!e.variants)return console.log("Skipping product without variants:",e),!1;if(!Array.isArray(e.variants))return console.log("Product variants is not an array:",e),!1;if(0===e.variants.length)return!1;let r=e.name.toLowerCase().includes(s.toLowerCase())||e.variants.some(e=>e.name?.toLowerCase().includes(s.toLowerCase())||e.sku&&e.sku.toLowerCase().includes(s.toLowerCase()));if("all"===t)return r;let a=e.variants.some(e=>"synced"===e.sync_status),n=e.variants.some(e=>"not_synced"===e.sync_status||!e.sync_status);return("synced"===t&&!!a||"not_synced"===t&&!!n)&&r}).map(e=>{let s=Array.isArray(e.variants)?e.variants:[];return{...e,filteredVariants:s.map(s=>{let t=s.lastSynced||void 0;return{...s,id:s.id||`${e.id}-${Math.random().toString(36).substring(2,11)}`,product_id:s.product_id||e.id,variant_id:s.variant_id||s.id||`variant-${Math.random().toString(36).substring(2,11)}`,retail_price:s.retail_price||(s.price?s.price.toString():"0.00"),name:s.name||"Unnamed Variant",lastSynced:t,sync_status:y(t)}})}}):(console.error("Products is not an array:",e),[]),[e,s,t]),j=n().useMemo(()=>g.reduce((e,s)=>e+s.filteredVariants.length,0),[g]);return(n().useEffect(()=>{o.setDefaultOptions({queries:{staleTime:3e5,gcTime:18e5}})},[o]),l)?(0,r.jsx)("div",{className:"text-center py-8",children:(0,r.jsx)("p",{className:"text-gray-500",children:"Loading products..."})}):0===g.length?(0,r.jsx)("div",{className:"text-center py-8",children:(0,r.jsx)("p",{className:"text-gray-500",children:"No products found matching your filters."})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mb-4 text-sm opacity-70",children:["Showing ",j," variants across ",g.length," ","products"]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Product"}),(0,r.jsx)("th",{children:"Variant"}),(0,r.jsx)("th",{children:"Variant ID"}),(0,r.jsx)("th",{children:"Price"}),(0,r.jsx)("th",{children:"Sync Status"}),(0,r.jsx)("th",{children:"Last Synced"})]})}),(0,r.jsx)("tbody",{children:g.map(e=>(0,r.jsxs)(n().Fragment,{children:[(0,r.jsx)(x,{product:e,onSyncAll:()=>f(e.id),isSyncing:p,syncingProductId:v?.productId||null,selectedSiteId:a}),e.filteredVariants.map(e=>(0,r.jsx)(m,{variant:e},e.id))]},e.id))})]})})]})},f=({searchQuery:e,statusFilter:s,onSearchChange:t,onStatusFilterChange:a})=>(0,r.jsxs)("div",{className:"mb-4 flex flex-col sm:flex-row justify-between gap-4",children:[(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"label text-xs",children:"Status"}),(0,r.jsxs)("div",{className:"btn-group space-x-1",children:[(0,r.jsx)("button",{className:`btn btn-xs ${"all"===s?"btn-primary":"btn-outline"}`,onClick:()=>a("all"),children:"All"}),(0,r.jsx)("button",{className:`btn btn-xs ${"synced"===s?"btn-primary":"btn-outline"}`,onClick:()=>a("synced"),children:"Synced"}),(0,r.jsx)("button",{className:`btn btn-xs ${"not_synced"===s?"btn-primary":"btn-outline"}`,onClick:()=>a("not_synced"),children:"Not Synced"}),(0,r.jsx)("button",{className:`btn btn-xs ${"error"===s?"btn-primary":"btn-outline"}`,onClick:()=>a("error"),children:"Error"})]})]})}),(0,r.jsxs)("div",{className:"form-control w-full sm:w-auto",children:[(0,r.jsx)("label",{className:"label",children:(0,r.jsx)("span",{className:"label-text text-xs",children:"Search"})}),(0,r.jsx)("input",{type:"text",value:e,onChange:e=>t(e.target.value),placeholder:"Search by name or ID...",className:"input input-bordered input-sm w-full"})]})]});var g=t(29494),j=t(79162);let w=async e=>{try{let s=await fetch(`/api/printful/store/products?siteId=${e}`);if(!s.ok)throw console.error("Error fetching products:",s.status,s.statusText),Error(`Failed to fetch products: ${s.statusText}`);return(await s.json()).result||[]}catch(e){return console.error("Error fetching products:",e),[]}};function b(){let{data:e}=(0,i.useSession)();(0,l.useRouter)();let{settings:s,updateSettings:t}=(0,j.z)(),[n,c]=(0,a.useState)(""),[d,u]=(0,a.useState)("all"),{data:p=[],isLoading:h,error:m}=(0,g.I)({queryKey:["products",s.siteId],queryFn:()=>w(s.siteId),enabled:!!s.siteId&&!!e,staleTime:3e5});return(0,r.jsx)("div",{className:"flex min-h-screen flex-col",children:(0,r.jsx)("main",{className:"flex-1 p-8",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Printful Product Variants"}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)(o.A,{onSettingsChange:t,initialSettings:s})}),!s.siteId||h||m?s.siteId?null:(0,r.jsx)("div",{className:"alert alert-info",children:(0,r.jsx)("span",{children:"Please select a Webflow site to view and sync products."})}):(0,r.jsxs)("div",{children:[(0,r.jsx)(f,{searchQuery:n,statusFilter:d,onSearchChange:c,onStatusFilterChange:u}),(0,r.jsx)(v,{products:p,searchQuery:n,statusFilter:d,selectedSiteId:s.siteId,webflowSettings:s,isLoading:h})]}),h&&(0,r.jsxs)("div",{className:"flex justify-center items-center p-8",children:[(0,r.jsx)("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("span",{className:"ml-2",children:"Loading products..."})]}),m&&(0,r.jsx)("div",{className:"alert alert-error",children:(0,r.jsxs)("span",{children:["Error loading products:"," ",m instanceof Error?m.message:"Unknown error"]})})]})})})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},35701:(e,s,t)=>{Promise.resolve().then(t.bind(t,19489))},48372:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c});var r=t(65239),a=t(48088),n=t(88170),i=t.n(n),l=t(30893),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);t.d(s,o);let c={children:["",{children:["products",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,8547)),"/Users/vicplummer/printful-app-test/src/app/products/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,96047))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,94431)),"/Users/vicplummer/printful-app-test/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,96047))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,d=["/Users/vicplummer/printful-app-test/src/app/products/page.tsx"],u={require:t,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/products/page",pathname:"/products",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79551:e=>{"use strict";e.exports=require("url")}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[243,181,658,138,123],()=>t(48372));module.exports=r})();