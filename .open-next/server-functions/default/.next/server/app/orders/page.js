(()=>{var e={};e.id=778,e.ids=[778],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8486:(e,s,r)=>{Promise.resolve().then(r.bind(r,67513))},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},25790:(e,s,r)=>{Promise.resolve().then(r.bind(r,88185))},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34346:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>l,metadata:()=>i});var t=r(37413),n=r(88185);let i={title:"Orders - Printful App",description:"Manage your Webflow orders and fulfill them with Printful"};function l(){return(0,t.jsx)(n.default,{})}},55524:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>l.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>u,tree:()=>o});var t=r(65239),n=r(48088),i=r(88170),l=r.n(i),a=r(30893),d={};for(let e in a)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>a[e]);r.d(s,d);let o={children:["",{children:["orders",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,34346)),"/Users/vicplummer/printful-app-test/src/app/orders/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,96047))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,94431)),"/Users/vicplummer/printful-app-test/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,96047))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/Users/vicplummer/printful-app-test/src/app/orders/page.tsx"],m={require:r,loadChunk:()=>Promise.resolve()},u=new t.AppPageRouteModule({definition:{kind:n.RouteKind.APP_PAGE,page:"/orders/page",pathname:"/orders",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67513:(e,s,r)=>{"use strict";r.d(s,{default:()=>v});var t=r(60687),n=r(43210),i=r(82136),l=r(16189),a=r(26785),d=r(8693),o=r(29494),c=r(54050);function m({orders:e,selectedOrderId:s,onSelectOrder:r}){if(!e.length)return(0,t.jsx)("p",{className:"text-gray-500",children:"No orders found"});let n=e=>{let s=new Date(e);return s.toLocaleDateString()+" "+s.toLocaleTimeString()};return(0,t.jsx)("div",{className:"overflow-y-auto max-h-[70vh]",children:(0,t.jsx)("ul",{className:"divide-y divide-gray-200",children:e.map(e=>(0,t.jsx)("li",{className:`py-3 cursor-pointer hover:bg-base-200 transition-colors ${s===e.id?"bg-base-200":""}`,onClick:()=>r(e.id),children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"font-medium",children:e.orderNumber}),(0,t.jsx)(u,{status:e.fulfillmentStatus})]}),(0,t.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:e.customerName}),(0,t.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,t.jsxs)("span",{className:"text-sm font-medium",children:["$",e.total.toFixed(2)]}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:n(e.createdOn)})]})]})},e.id))})})}function u({status:e}){let s="px-2 py-1 text-xs rounded-full";switch(e){case"fulfilled":s+=" bg-green-100 text-green-800";break;case"partially_fulfilled":s+=" bg-yellow-100 text-yellow-800";break;default:s+=" bg-gray-100 text-gray-800"}return(0,t.jsx)("span",{className:s,children:"unfulfilled"===e?"Unfulfilled":"partially_fulfilled"===e?"Partial":"Fulfilled"})}var x=r(30474);function h(){return(0,t.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,t.jsx)("div",{className:"loading loading-spinner loading-lg"})})}function p({message:e}){return(0,t.jsxs)("div",{className:"alert alert-error",children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsx)("span",{children:e})]})}function f({orderId:e,siteId:s,onOrderFulfilled:r}){let[i,l]=(0,n.useState)(null),{data:a,isLoading:d,isError:m,error:u}=(0,o.I)({queryKey:["order-details",s,e],queryFn:async()=>{let r=await fetch(`/api/webflow/orders/${e}?siteId=${s}`);if(!r.ok)throw Error("Failed to fetch order details");return r.json()}}),{mutate:f,isPending:j}=(0,c.n)({mutationFn:async()=>{let r=await fetch("/api/webflow/orders/fulfill",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e,siteId:s})});if(!r.ok)throw Error((await r.json()).error||"Failed to send order to Printful");return r.json()},onSuccess:()=>{l(null),r()},onError:e=>{l(e.message||"Failed to send order to Printful")}});if(d)return(0,t.jsx)(h,{});if(m)return(0,t.jsx)(p,{message:`Error loading order details: ${u?.toString()}`});if(!a?.result)return(0,t.jsx)("div",{children:"No order details found"});let{result:g}=a;return(0,t.jsxs)("div",{className:"bg-base-100 shadow rounded-lg p-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{className:"text-xl font-semibold",children:["Order #",g.orderNumber]}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Created on ",new Date(g.createdOn).toLocaleString()]})]}),"unfulfilled"===g.fulfillmentStatus&&(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>f(),disabled:j,children:j?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"loading loading-spinner loading-xs"}),"Sending to Printful..."]}):"Send to Printful"})]}),i&&(0,t.jsxs)("div",{className:"alert alert-error mb-4",children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsx)("span",{children:i})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"Customer Information"}),(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("p",{className:"font-medium",children:g.customerInfo.name}),(0,t.jsx)("p",{children:g.customerInfo.email}),g.customerInfo.phone&&(0,t.jsx)("p",{children:g.customerInfo.phone})]}),(0,t.jsx)("h3",{className:"font-semibold mt-4 mb-2",children:"Shipping Address"}),(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("p",{children:g.customerInfo.address.line1}),g.customerInfo.address.line2&&(0,t.jsx)("p",{children:g.customerInfo.address.line2}),(0,t.jsxs)("p",{children:[g.customerInfo.address.city,","," ",g.customerInfo.address.state," ",g.customerInfo.address.postalCode]}),(0,t.jsx)("p",{children:g.customerInfo.address.country})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"Order Items"}),(0,t.jsx)("div",{className:"space-y-4",children:g.purchasedItems?.map(e=>t.jsxs("div",{className:"flex items-start gap-4",children:[e.thumbnailUrl&&t.jsx("div",{className:"w-16 h-16 relative",children:t.jsx(x.default,{src:e.thumbnailUrl,alt:e.name,fill:!0,className:"object-cover rounded"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"font-medium",children:e.name}),t.jsx("p",{className:"text-sm text-gray-500",children:e.variantName}),t.jsxs("div",{className:"flex justify-between mt-1",children:[t.jsxs("p",{className:"text-sm",children:["$",e.price," \xd7 ",e.quantity]}),t.jsxs("p",{className:"font-medium",children:["$",(e.price*e.quantity).toFixed(2)]})]})]})]},e.id))}),(0,t.jsx)("div",{className:"border-t mt-4 pt-4",children:(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("p",{className:"font-semibold",children:"Total"}),(0,t.jsxs)("p",{className:"font-semibold",children:["$",g.total.toFixed(2)]})]})}),g.notes&&(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"Order Notes"}),(0,t.jsx)("p",{className:"text-sm",children:g.notes})]}),g.shippingInfo.tracking&&(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"Shipping Information"}),(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsxs)("p",{children:["Provider: ",g.shippingInfo.provider]}),(0,t.jsxs)("p",{children:["Tracking:"," ",g.shippingInfo.trackingUrl?(0,t.jsx)("a",{href:g.shippingInfo.trackingUrl,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:g.shippingInfo.tracking}):g.shippingInfo.tracking]})]})]})]})]})]})}var j=r(79162);function g(){let[e,s]=(0,n.useState)(null),[r,i]=(0,n.useState)(null),{settings:l}=(0,j.z)(),a=(0,d.jE)(),{data:u,isLoading:x,error:g}=(0,o.I)({queryKey:["orders",l.siteId],queryFn:async()=>{if(!l.siteId)return{result:[]};let e=await fetch(`/api/webflow/orders?siteId=${l.siteId}`);if(!e.ok)throw Error("Failed to fetch orders");return e.json()},enabled:!!l.siteId,staleTime:3e4,gcTime:3e5,refetchOnWindowFocus:!1}),{mutate:v,isPending:b}=(0,c.n)({mutationFn:async()=>{let e=await fetch("/api/webflow/orders/fulfill-bulk",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:l.siteId})});if(!e.ok)throw Error((await e.json()).error||"Failed to send orders to Printful");return e.json()},onSuccess:()=>{i(null),a.invalidateQueries({queryKey:["orders",l.siteId]})},onError:e=>{i(e.message||"Failed to send orders to Printful")}}),N=u?.result?.filter(e=>"unfulfilled"===e.fulfillmentStatus).length||0;return x?(0,t.jsx)(h,{}):g?(0,t.jsx)(p,{message:g.toString()}):(0,t.jsxs)(t.Fragment,{children:[r&&(0,t.jsxs)("div",{className:"alert alert-error mb-4",children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsx)("span",{children:r})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsxs)("h2",{className:"text-xl font-semibold",children:["Orders (",u?.result?.length||0,")"]}),N>0&&(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>v(),disabled:b,children:b?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"loading loading-spinner loading-xs"}),"Sending ",N," orders..."]}):`Send All to Printful (${N})`})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(m,{orders:u?.result||[],selectedOrderId:e,onSelectOrder:s}),e&&(0,t.jsx)(f,{orderId:e,siteId:l.siteId,onOrderFulfilled:()=>{a.invalidateQueries({queryKey:["orders",l.siteId]})}})]})]})}function v(){let{data:e}=(0,i.useSession)();(0,l.useRouter)();let{settings:s,updateSettings:r}=(0,j.z)();return e?(0,t.jsx)("div",{className:"flex min-h-screen flex-col",children:(0,t.jsx)("main",{className:"flex-1 p-8",children:(0,t.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Orders"}),(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsx)(a.A,{onSettingsChange:r,initialSettings:s})}),s.siteId?(0,t.jsx)(g,{}):(0,t.jsxs)("div",{className:"alert alert-info",children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"stroke-current shrink-0 w-6 h-6",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsx)("span",{children:"Please select a Webflow site to view orders."})]})]})})}):(0,t.jsx)("div",{className:"flex min-h-screen flex-col",children:(0,t.jsx)("main",{className:"flex-1 p-8",children:(0,t.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,t.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Loading..."})})})})}},79551:e=>{"use strict";e.exports=require("url")},88185:(e,s,r)=>{"use strict";r.d(s,{default:()=>t});let t=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/vicplummer/printful-app-test/src/components/orders/OrdersPageClient.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/vicplummer/printful-app-test/src/components/orders/OrdersPageClient.tsx","default")}};var s=require("../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[243,181,658,138,123],()=>r(55524));module.exports=t})();